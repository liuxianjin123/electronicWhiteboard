<template>
  <div class="container" id="container">
    <div class="container-top" :style="{ background: containerBg }">
      <div class="container-item-left">
        <aside>
          <ul style="margin: 0; padding: 0; margin-bottom: 80px">
            <li
              @click="toggle($event)"
              :class="[isActive == '分析' ? 'liCkeced' : '']"
              class="liCkeced"
            >
              <img :src="[isActive == '分析' ? jbCheck : jb]" alt="" />
              <span>分析</span>
            </li>
            <li :class="[isActive == '排班' ? 'liCkeced' : '']">
              <img :src="[isActive == '排班' ? pbCheck : pb]" alt="" />
              <span>排班</span>
            </li>
            <li @click="toggle($event)">
              <img :src="[isActive == '患者' ? hzCheck : hz]" alt="" />
              <span>患者</span>
            </li>
            <li @click="toggle($event)">
              <img :src="[isActive == '首页' ? homeCheck : home]" alt="" />
              <span>首页</span>
            </li>
          </ul>
        </aside>
      </div>
      <div class="container-item-right">
        <header>
          <shead
            :hospitalName="hospitalName"
            :wardName="wardName"
            :dates="dates"
          ></shead>
        </header>
        <section class="item-config">
          <a-spin :spinning="spinning" size="large">
            <div>
              <table>
                <thead>
                  <tr>
                    <th colspan="3">
                      <ul class="sdzb shadow">
                        <li v-for="item in topData" :key="item.name">
                          <img :src="item.imgUrl" alt="" />
                          <div>
                            <p>{{ item.title }}</p>
                            <p>{{ item.brNum }} 人</p>
                            <p>
                              <span
                                :style="{
                                  color: item.isChange ? 'green' : 'red',
                                }"
                                ><a-icon
                                  :type="item.icon"
                                  style="
                                    font-size: 18px;
                                    vertical-align: middle;
                                  "
                                />{{ item.bfb }}</span
                              >
                              <span style="color: gray"> 同比昨日</span>
                            </p>
                          </div>
                        </li>
                      </ul>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th style="width: 450px">
                      <div class="zwzb shadow">
                        <div class="zwzb-top">
                         <b> 床位占比</b>
                        </div>
                        <div style="height:200px;" class="zwzb-bottom">
                          <div id="zwzbEcharts"></div>
                          <div class="zwzb-child">
                            <ul>
                              <li><b>总 床 位：123 张</b></li>
                              <li><a-badge status="default" />空床数：103张</li>
                              <li><a-badge status="warning" />占床数：20张</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="sshz shadow">sshz</div>
                    </th>
                    <th>
                      <div class="fxpg shadow">fxpg</div>
                    </th>
                    <th>
                      <div class="hzld shadow">hzld</div>
                      <div class="hljb shadow">hljb</div>
                    </th>
                  </tr>
                </tbody>
              </table>
            </div>
          </a-spin>
        </section>
      </div>
    </div>
    <div class="container-bottom">
      <a-icon type="sync" :spin="isSpin" @click="load" />
      <a-icon :type="full" @click="fulls" />
    </div>
  </div>
</template>
<script>
import Shead from "../../views/Board/nursingBoardHead";
import vueSeamlessScroll from "vue-seamless-scroll";
import { post, get } from "../../../request/request";
import { getDate, fullScreen, exitFull } from "../../../../static/js/Board";
export default {
  name: "nursingBoard",
  data() {
    return {
      hospitalName: "绵阳市三台县人民医院", //医院名称
      bqdm: "", //医院所属病区
      item: "", //同病区不同楼层分组
      spinning: true,
      wardName: "XXX病区", //病区名称
      dates: "8888-88-88 88:88 星期一", //当前时间
      jb: "../../../../static/images/Board/jb.png", //交班图标
      jbCheck: "../../../../static/images/Board/jbChecked.png", //交班被选中图标
      pb: "../../../../static/images/Board/pb.png", //排班图标
      pbCheck: "../../../../static/images/Board/pbChecked.png", //排班被选中图标
      hz: "../../../../static/images/Board/hz.png", //患者图标
      hzCheck: "../../../../static/images/Board/hzChecked.png", //患者被选中图标
      home: "../../../../static/images/Board/home.png", //首页
      homeCheck: "", //首页被选中
      containerBg: "url(../../../../static/images/Board/4.png)", //点击那个就切换那个对应的背景（主要设置item处的圆角）
      isActive: "分析", //点击那个item给那个加上类名
      full: "fullscreen", //切换全屏图标
      checckTemplate: null, //当前点击的模块对应的数组
      isSpin: true, //刷新图标动起来
      isFullScreen: false, //是否全屏
      isCarousel: true, //是否展示轮播
      brxxData: null,
      topData: [
        {
          name: "hzzs",
          imgUrl: "~@../../../static/images/Board/yy.png",
          title: "患者总数",
          brNum: "--",
          bfb: "10%",
          icon: "caret-up",
          isChange: true,
        },
        {
          name: "jrry",
          imgUrl: "~@../../../static/images/Board/sx.png",
          title: "今日入院",
          brNum: "98",
          bfb: "10%",
          icon: "caret-up",
          isChange: false,
        },
        {
          name: "jrcy",
          imgUrl: "~@../../../static/images/Board/tb.png",
          title: "今日出院",
          brNum: "--",
          bfb: "10%",
          icon: "caret-down",
          isChange: true,
        },
        {
          name: "jrss",
          imgUrl: "~@../../../static/images/Board/ssd.png",
          title: "今日手术",
          brNum: "--",
          bfb: "10%",
          icon: "caret-down",
          isChange: false,
        },
      ],
    };
  },
  components: {
    Shead,
    vueSeamlessScroll,
  },
  methods: {
    toggle(e) {
      //点击切换左边的item，顺便切换背景图
      switch (e.currentTarget.lastElementChild.innerHTML) {
        case "分析":
          break;
        case "排班":
          break;
        case "患者":
          break;
        case "首页":
          this.$router.push({
            path: "/nursingBoard",
            query: {
              bqdm: this.bqdm,
              item: this.item,
            },
          });
          break;
      }
    },
    fulls() {
      //全屏&退出全屏
      this.full = this.full == "fullscreen" ? "fullscreen-exit" : "fullscreen";
      if (!this.isFullScreen) {
        this.isFullScreen = true;
        fullScreen();
      } else {
        this.isFullScreen = false;
        exitFull();
      }
    },
    load() {
      //再次手动加载数据
      this.isSpin = true;
      this.getDataAll();
    },
    async getDataAll() {
      this.isSpin = true;
      this.spinning = true;
      const res = await get("/WhiteBoard/WBApi.ashx/GetPatients", {
        bqdm: this.bqdm,
      });
      console.log(res);
      if (res.msg == "成功" && res.result != null) {
        this.isSpin = !this.isSpin;
        this.spinning = !this.spinning;
        this.brxxData = res.result.patients;
        console.log(this.brxxData);
      }
    },
    qst() {
      const chart = this.$refs.smtz;
      var myChart = this.$echarts.init(zwzbEcharts);
      var option = {
        tooltip: {
          show:false
        },
        legend: {
          show:false
        },
        series: [
          {
            name: "",
            type: "pie",
            radius: ["70%", "95%"],
            color:['#ddd','orange'],
            avoidLabelOverlap: false,
            itemStyle: {  
              borderRadius: 5,
              borderColor: "#fff",
              borderWidth: 2,
            },
            label: {
              show: true,
              position: "center",
              formatter: function(){
                return '95%'
              },
              textStyle:{
                fontSize: "20",
                fontWeight: "bold",
                color:"orange"
              }
            },
            emphasis: {
              label: {
                show: true,
                fontSize: "20",
                fontWeight: "bold",
              },
            },
            labelLine: {
              show: false,
            },
            data: [
              { value: 30, name: "空床数" },
              { value: 150, name: "占床数" },
            ],
          },
        ],
      };
      if (option && typeof option === "object") {
        myChart.setOption(option, true);
      }
      window.onresize = function () {
        myChart.resize();
      };
    },
  },
  mounted() {
    fullScreen();
    this.qst();
    setInterval(() => {
      //页面创建完成加载当前时间。1s一次
      this.dates = getDate();
    }, 1000);
    var query = this.$route.query;
    this.bqdm = query.bqdm;
    this.item = query.item;
    this.wardName = query.wardName;
    this.getDataAll();
    setInterval(() => {
      //没5分钟刷新一系整体数据
      this.getDataAll();
    }, 60 * 5000);
  },
};
</script>

<style  scoped>
@import url("../../../../static/css/Board.css");
ul li {
  color: #000;
}
.container-item-right section,
.container-item-right section table {
  height: 930px;
}
.container-item-right header {
  height: 90px;
}
.container-item-right section table thead {
  height: 150px;
}
.container-item-right section table tbody tr th > div:last-child {
  margin-top: 23px;
}
.container-item-right section table tbody tr th > div:first-child {
  margin-top: 0;
}
section table tbody tr th {
  font-weight: inherit;
}
.sdzb {
  margin: 10px;
  padding: 0;
  height: 150px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 60px !important;
}
.sdzb li {
  display: flex;
  justify-content: center;
  align-items: center;
  color: #000;
}
.sdzb li img {
  width: 110px;
  height: 110px;
}
.sdzb li > div {
  flex: 1;
  line-height: 33px;
}
.sdzb li > div p {
  margin: 0;
  font-weight: 400;
  text-align: center;
}
.sdzb li > div p:first-child {
  font-size: 18px;
  color: gray;
}
.sdzb li > div p:nth-child(2) {
  font-size: 17px;
  font-weight: bold;
}
.shadow {
  box-shadow: rgb(215 215 215 / 100%) 5px 5px 5px;
  border-radius: 45px;
  background: #fff;
  margin: 10px;
  padding: 10px;
}
.zwzb {
  height: 255px;
}
.zwzb-top{
  height:30px;
  padding-left:17px;
  line-height: 30px;
}
.zwzb-bottom{
  display: flex;
  justify-content:space-around;
  align-items: center;
}
.zwzb #zwzbEcharts {
  width: 180px;
  height: 180px;
}
.zwzb .zwzb-child {
  line-height: 50px;
}
.sshz {
  height: 455px;
}
.fxpg {
  height: 730px;
}
.hzld {
  height: 352px;
}
.hljb {
  height: 352px;
}
</style>
